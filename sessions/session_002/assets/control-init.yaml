package_update: true
packages:
  - conntrack
users:
  - default
disable_root: false
ssh_authorized_keys:
  - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCvW2dRLu0PLQeQ5q5X76RaPvh8/lhhTzucdOizgzJfbUClve4KVCivtB1/S0rX6uuZL6TZhtRDrB1bVGAkwnt6zTT/irQ1ly1AseLAGIdA+03ikQ4gD1hL+MPURko4O9qWyDpBzPtjinRkXYTPdDe3g5jj1CZMI8uw+oOwdxf/9efeEfiQZ+pZuqgtEJttxWx3NrLqiyZhiciSVoRxyXkOltMdovzNeeeRB0KkFKhjSWhjTW0QRJ19ZsDtH3lxChQd7YFfTtYL0oe3ZkRINzHwfr1vzTVaolWTF70H4LWFaTZpmFWZ+WmmXNriUHwov2TBsCYRMAJkM72PAi8WmtWR calico@cloud
ca_certs:
  trusted:
    - registry_ca_crt
    - |
      -----BEGIN CERTIFICATE-----
      MIIDWzCCAkOgAwIBAgIUepDkYPplYhVdZiw/OuLAx2RILIUwDQYJKoZIhvcNAQEL
      BQAwPTEVMBMGA1UEAwwMcHJpdmF0ZS1yZXBvMRcwFQYDVQQKDA5XZSBsb3ZlIENh
      bGljbzELMAkGA1UEBhMCVVMwHhcNMjMwNjI5MTU1MjU2WhcNMjYwNDE4MTU1MjU2
      WjA9MRUwEwYDVQQDDAxwcml2YXRlLXJlcG8xFzAVBgNVBAoMDldlIGxvdmUgQ2Fs
      aWNvMQswCQYDVQQGEwJVUzCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEB
      ALYlYQytw7Fe9H9jRMT/czHiPesM1M65h9M93wXxSADNoMFlD4mmAwNcZIVZXXfc
      VnvZxnU4GPHFEGSW5mKjGiHQvag7uClCEMEe5E9LFDNu+k9E1TunSEsmfhPdyXbb
      vxTAFjpB+WftwGT4EjZfG/d9lKC6WxD8FOMPO3Bd5y1rr1xiexwXg7puWj7r96E4
      S0z7DWBqx0AOS3NEeQYgpKywR6g2f+SbUwwi+Ookt8G7YYyG9mWRwM6EVdafwoO4
      YPk6MopzSVRc05HVm0TrDjyRFiU4wRg3dAWN1r2EoPUPtOMR0vi6TlAWt0tYfg51
      Wt0diVsMN/2i548Z9UBOvb0CAwEAAaNTMFEwHQYDVR0OBBYEFKznvhYJgxRgrSJV
      WQxfO9tLTyqoMB8GA1UdIwQYMBaAFKznvhYJgxRgrSJVWQxfO9tLTyqoMA8GA1Ud
      EwEB/wQFMAMBAf8wDQYJKoZIhvcNAQELBQADggEBAG0/+7g7Komfp4hIb91RbghF
      uIx5SM8XXyrDFghQeKWNRHXIfXoB3BVBXSvDxyfGldiGTTmFaYKniN9M0vFWRTyf
      qu4rZseOwIKCpPokgXE87isVhzFlLiWdHeNKJIuoWvkMHcvaP3KvwmBPUsy8hWwY
      2BSn7OS5OR5iIAb9qTiipM5vBiBxKJhJ1pgijFQJNBICkQzPW3adsB5o4iULCg+s
      OhkNZ7yE+MCKrw8JfZQhSsQNsS4Vc41tjYs7B1AdT3EiG4TJKkpN64deDQaRJFrt
      /vh2WObsirzYVNWzqKo8eezl2RdfCWsZ1LNHVPyGiHRtZytmOJrcUnjSWXuTxKo=
      -----END CERTIFICATE-----
write_files:
- encoding: b64
  content: IyEvYmluL2Jhc2gKI0szU19WRVJTSU9OPSJ2MS4yMy4xNiUyQmszczEiCkszU19WRVJTSU9OPSJ2MS4yNS44JTJCazNzMSIKCkFSQ0g9YHVuYW1lIC1tYAppZiBbWyAkQVJDSCA9PSAieDg2XzY0IiBdXQp0aGVuCmVjaG8gIkRvd25sb2FkaW5nIGszcyBiaW5hcnkgZm9yICRBUkNIIgovdXNyL2Jpbi9jdXJsIC1MIGh0dHBzOi8vZ2l0aHViLmNvbS9rM3MtaW8vazNzL3JlbGVhc2VzL2Rvd25sb2FkLyRLM1NfVkVSU0lPTi9rM3MgLW8gL3Vzci9sb2NhbC9iaW4vazNzCmVjaG8gIkRvd25sb2FkaW5nIGNhbGljb2N0bCBiaW5hcnkgJEFSQ0giCi91c3IvYmluL2N1cmwgLUwgaHR0cHM6Ly9naXRodWIuY29tL3Byb2plY3RjYWxpY28vY2FsaWNvL3JlbGVhc2VzL2xhdGVzdC9kb3dubG9hZC9jYWxpY29jdGwtbGludXgtYW1kNjQgLW8gL3Vzci9sb2NhbC9iaW4vY2FsaWNvY3RsCmVsc2UKZWNobyAiRG93bmxvYWRpbmcgazNzIGJpbmFyeSBmb3IgJEFSQ0giCi91c3IvYmluL2N1cmwgLUwgaHR0cHM6Ly9naXRodWIuY29tL2szcy1pby9rM3MvcmVsZWFzZXMvZG93bmxvYWQvJEszU19WRVJTSU9OL2szcy1hcm02NCAtbyAvdXNyL2xvY2FsL2Jpbi9rM3MKZWNobyAiRG93bmxvYWRpbmcgY2FsaWNvY3RsIGJpbmFyeSAkQVJDSCIKL3Vzci9iaW4vY3VybCAtTCBodHRwczovL2dpdGh1Yi5jb20vcHJvamVjdGNhbGljby9jYWxpY28vcmVsZWFzZXMvbGF0ZXN0L2Rvd25sb2FkL2NhbGljb2N0bC1saW51eC1hcm02NCAtbyAvdXNyL2xvY2FsL2Jpbi9jYWxpY29jdGwKZmkKCi91c3IvYmluL2NobW9kICt4IC91c3IvbG9jYWwvYmluL2szcwovdXNyL2Jpbi9jaG1vZCAreCAvdXNyL2xvY2FsL2Jpbi9jYWxpY29jdGwgCgovdXNyL2Jpbi9jdXJsIGh0dHBzOi8vZ2V0Lmszcy5pby8gPiAvcm9vdC9pbnN0YWxsLnNoCi91c3IvYmluL2NobW9kICt4IC9yb290L2luc3RhbGwuc2gKCiMgTWFjIE9TIGRpc2NvdmVyeSBmaXgKY2F0ID4+IC9ldGMvc3lzdGVtZC9yZXNvbHZlZC5jb25mIDw8LUVPRgpNdWx0aWNhc3RETlM9eWVzCkRvbWFpbnM9bXVsdGlwYXNzIG1zaG9tZS5uZXQgbG9jYWwKRU9GCi91c3IvYmluL3N5c3RlbWN0bCBlbmFibGUgc3lzdGVtZC1yZXNvbHZlZC5zZXJ2aWNlCi91c3IvYmluL3N5c3RlbWN0bCByZXN0YXJ0IHN5c3RlbWQtcmVzb2x2ZWQuc2VydmljZQoKY2F0ID4gL2V0Yy9zeXN0ZW1kL3N5c3RlbS9tZG5zQC5zZXJ2aWNlIDw8LUVPRgpbU2VydmljZV0KVHlwZT1vbmVzaG90CkV4ZWNTdGFydD0vdXNyL2Jpbi9yZXNvbHZlY3RsIG1kbnMgJWkgeWVzCkFmdGVyPXN5cy1zdWJzeXN0ZW0tbmV0LWRldmljZXMtJWkuZGV2aWNlCgpbSW5zdGFsbF0KV2FudGVkQnk9c3lzLXN1YnN5c3RlbS1uZXQtZGV2aWNlcy0laS5kZXZpY2UKRU9GCgpJTlRFUkZBQ0U9YGlwIGxpbmsgc2hvdyAgfCBlZ3JlcCAiWzAtOV06IGVuIiB8IGF3ayAneyBwcmludCAkMiB9JyB8IGN1dCAtZDogLWYxYAoKL3Vzci9iaW4vc3lzdGVtY3RsIGVuYWJsZSBtZG5zQCRJTlRFUkZBQ0Uuc2VydmljZQovdXNyL2Jpbi9zeXN0ZW1jdGwgc3RhcnQgbWRuc0AkSU5URVJGQUNFLnNlcnZpY2UKIyBNYWMgT1MgZGlzY292ZXJ5IGZpeAo=
  owner: root:root
  path: /root/prepare.sh
- encoding: b64
  content: IyEvYmluL2Jhc2gKCiMgSW5jcmVhc2UgcG9kLWNvdW50CmNhdCA+PiAgL2V0Yy9rdWJlbGV0LmNvbmYgPDwtRU9GCmFwaVZlcnNpb246IGt1YmVsZXQuY29uZmlnLms4cy5pby92MWJldGExCmtpbmQ6IEt1YmVsZXRDb25maWd1cmF0aW9uCm1heFBvZHM6IDQwMDAKRU9GCiMgSW5jcmVhc2UgcG9kLWNvdW50CgpJTlNUQUxMX0szU19TS0lQX0RPV05MT0FEPXRydWUgSzNTX0tVQkVDT05GSUdfTU9ERT0iNjQ0IiBJTlNUQUxMX0szU19FWEVDPSItLWt1YmVsZXQtYXJnPWNvbmZpZz0vZXRjL2t1YmVsZXQuY29uZiAtLWZsYW5uZWwtYmFja2VuZD1ub25lIC0tY2x1c3Rlci1jaWRyPTE3Mi4xNi4wLjAvMTYgLS1kaXNhYmxlLW5ldHdvcmstcG9saWN5IC0tZGlzYWJsZT10cmFlZmlrLGxvY2FsLXN0b3JhZ2UsbWV0cmljcy1zZXJ2ZXIsc2VydmljZWxiIiAvcm9vdC9pbnN0YWxsLnNoCg==
  owner: root:root
  path: /root/control.sh

runcmd:
  - [ /usr/bin/chmod, +x, /root/prepare.sh ]
  - [ /root/prepare.sh ]
  - [ /usr/bin/chmod, +x, /root/control.sh ]
  - [ /root/control.sh ]
  - [ /usr/bin/chown, -R, ubuntu:ubuntu, /home/ubuntu ]
  - [ /usr/bin/systemctl, enable, k3s.service ]

power_state:
  mode: reboot
